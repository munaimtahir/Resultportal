# Generated by Django 5.2.7 on 2025-10-25 22:42

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('accounts', '0005_yearclass_student_phone_alter_student_status_and_more'),
        ('results', '0002_alter_result_roll_number'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.AddField(
            model_name='importbatch',
            name='errors_json',
            field=models.JSONField(blank=True, default=list, help_text='List of error messages from validation'),
        ),
        migrations.AddField(
            model_name='importbatch',
            name='warnings_json',
            field=models.JSONField(blank=True, default=list, help_text='List of warning messages from validation'),
        ),
        migrations.AddField(
            model_name='result',
            name='practical',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='Practical/viva component marks', max_digits=6, null=True),
        ),
        migrations.AddField(
            model_name='result',
            name='status',
            field=models.CharField(choices=[('DRAFT', 'Draft'), ('SUBMITTED', 'Submitted'), ('RETURNED', 'Returned'), ('VERIFIED', 'Verified'), ('PUBLISHED', 'Published')], default='DRAFT', help_text='Current workflow status', max_length=20),
        ),
        migrations.AddField(
            model_name='result',
            name='status_log',
            field=models.JSONField(blank=True, default=list, help_text='Audit trail of status changes'),
        ),
        migrations.AddField(
            model_name='result',
            name='theory',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='Theory/written component marks', max_digits=6, null=True),
        ),
        migrations.AddField(
            model_name='result',
            name='total',
            field=models.DecimalField(blank=True, decimal_places=2, help_text='Total marks', max_digits=6, null=True),
        ),
        migrations.AddField(
            model_name='result',
            name='verified_at',
            field=models.DateTimeField(blank=True, help_text='When result was verified', null=True),
        ),
        migrations.AddField(
            model_name='result',
            name='verified_by',
            field=models.ForeignKey(blank=True, help_text='Admin who verified this result', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_results', to=settings.AUTH_USER_MODEL),
        ),
        migrations.AlterField(
            model_name='result',
            name='total_marks',
            field=models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True),
        ),
        migrations.AlterField(
            model_name='result',
            name='viva_marks',
            field=models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True),
        ),
        migrations.AlterField(
            model_name='result',
            name='written_marks',
            field=models.DecimalField(blank=True, decimal_places=2, max_digits=6, null=True),
        ),
        migrations.CreateModel(
            name='Exam',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(help_text="Unique exam code (e.g., 'BLOCK-E-2024')", max_length=50, unique=True)),
                ('title', models.CharField(help_text='Full exam title', max_length=200)),
                ('kind', models.CharField(choices=[('BLOCK', 'Block Exam'), ('SEND_UP', 'Send-up Exam'), ('UNIVERSITY', 'University Exam'), ('TEST', 'Test')], default='BLOCK', help_text='Type of examination', max_length=20)),
                ('block_letter', models.CharField(blank=True, help_text='Block letter (A, B, C, etc.) if applicable', max_length=5)),
                ('exam_date', models.DateField(help_text='Primary exam date')),
                ('recheck_form_url', models.URLField(blank=True, help_text='URL to recheck application form')),
                ('recheck_deadline', models.DateTimeField(blank=True, help_text='Deadline for recheck requests', null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('year_class', models.ForeignKey(help_text='Year/class this exam is for', on_delete=django.db.models.deletion.PROTECT, related_name='exams', to='accounts.yearclass')),
            ],
            options={
                'ordering': ('-exam_date', 'code'),
            },
        ),
        migrations.AddField(
            model_name='importbatch',
            name='exam',
            field=models.ForeignKey(blank=True, help_text='Exam this batch is associated with (for result imports)', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='import_batches', to='results.exam'),
        ),
        migrations.AddField(
            model_name='result',
            name='exam',
            field=models.ForeignKey(blank=True, help_text='Exam this result belongs to', null=True, on_delete=django.db.models.deletion.PROTECT, related_name='results', to='results.exam'),
        ),
        migrations.AddIndex(
            model_name='exam',
            index=models.Index(fields=['code'], name='exam_code_idx'),
        ),
        migrations.AddIndex(
            model_name='exam',
            index=models.Index(fields=['year_class', 'exam_date'], name='exam_year_date_idx'),
        ),
    ]
