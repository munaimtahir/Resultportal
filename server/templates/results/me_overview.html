{% extends "base.html" %}

{% block title %}My Dashboard · Result Portal{% endblock %}

{% block content %}
  <main style="max-width: 960px; margin: 0 auto; padding: 3rem 1.5rem 4rem;">
    <header style="display: flex; justify-content: space-between; align-items: center; gap: 1rem; margin-bottom: 2.5rem;">
      <div>
        <p style="margin: 0; color: #64748b; font-size: 0.9rem;">Signed in as</p>
        <h1 style="margin: 0.3rem 0 0; font-size: 2rem; font-weight: 600; color: #0f172a;">
          {{ student.display_name|default:student.official_email }}
        </h1>
        <p style="margin: 0.6rem 0 0; color: #475569; font-size: 0.95rem;">
          {{ student.official_email }}{% if student.roll_number %} · Roll {{ student.roll_number }}{% endif %}
        </p>
      </div>
      <a
        href="{% url 'results:me-results' %}"
        style="background-color: #2563eb; color: #fff; padding: 0.75rem 1.5rem; border-radius: 9999px; font-weight: 600;"
        >View all results</a
      >
    </header>

    <section
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; margin-bottom: 3rem;"
    >
      <article
        style="background: #fff; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 20px 45px -20px rgba(15, 23, 42, 0.25);"
      >
        <h2 style="margin: 0; font-size: 0.9rem; font-weight: 600; letter-spacing: 0.02em; color: #475569;">Published results</h2>
        <p style="margin: 0.75rem 0 0; font-size: 2.4rem; font-weight: 700; color: #0f172a;">
          {{ published_count }}
        </p>
        <p style="margin: 0.25rem 0 0; color: #64748b; font-size: 0.9rem;">
          {% if has_results %}
            Latest update {{ recent_results.0.exam_date|date:"j M Y" }}
          {% else %}
            Waiting on your first published result.
          {% endif %}
        </p>
      </article>

      <article
        style="background: #fff; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 20px 45px -20px rgba(15, 23, 42, 0.25);"
      >
        <h2 style="margin: 0; font-size: 0.9rem; font-weight: 600; letter-spacing: 0.02em; color: #475569;">Status</h2>
        <p style="margin: 0.75rem 0 0; font-size: 1.3rem; font-weight: 600; color: #0f172a; text-transform: capitalize;">
          {{ student.get_status_display }}
        </p>
        <p style="margin: 0.25rem 0 0; color: #64748b; font-size: 0.9rem;">
          {% if student.is_active %}
            Your portal access is active.
          {% else %}
            Contact the registrar to reactivate your account.
          {% endif %}
        </p>
      </article>
    </section>

    <section style="margin-bottom: 3rem;">
      <h2 style="margin: 0 0 1rem; font-size: 1.2rem; font-weight: 600; color: #0f172a;">Recent results</h2>
      {% if has_results %}
        <div style="overflow: hidden; border-radius: 1rem; background: #fff; box-shadow: 0 20px 45px -20px rgba(15, 23, 42, 0.25);">
          <table style="width: 100%; border-collapse: collapse; font-size: 0.95rem;">
            <thead style="background: #f1f5f9; color: #475569; text-align: left;">
              <tr>
                <th style="padding: 0.85rem 1.25rem; font-weight: 600;">Subject</th>
                <th style="padding: 0.85rem 1.25rem; font-weight: 600;">Exam date</th>
                <th style="padding: 0.85rem 1.25rem; font-weight: 600;">Total</th>
                <th style="padding: 0.85rem 1.25rem; font-weight: 600;">Grade</th>
              </tr>
            </thead>
            <tbody>
              {% for result in recent_results %}
                <tr style="border-bottom: 1px solid #e2e8f0;">
                  <td style="padding: 0.85rem 1.25rem; font-weight: 500; color: #0f172a;">{{ result.subject }}</td>
                  <td style="padding: 0.85rem 1.25rem; color: #475569;">{{ result.exam_date|date:"j M Y" }}</td>
                  <td style="padding: 0.85rem 1.25rem; color: #0f172a; font-weight: 600;">{{ result.total_marks|floatformat:2 }}</td>
                  <td style="padding: 0.85rem 1.25rem; color: #2563eb; font-weight: 600;">{{ result.grade }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="margin: 1rem 0 0; color: #64748b;">Once results are published you'll see them here.</p>
      {% endif %}
    </section>

    <footer style="display: flex; justify-content: space-between; align-items: center; color: #94a3b8; font-size: 0.85rem;">
      <span>Punjab Medical College Result Portal</span>
      <a href="{% url 'accounts:logout' %}" style="color: inherit;">Sign out</a>
    </footer>
  </main>
{% endblock %}
